<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pupicreditos Wallet</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        #app {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        input {
            display: block;
            margin: 10px auto;
            padding: 10px;
            width: 80%;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        .icon {
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1>Pupicreditos Wallet</h1>
        <div id="login-form">
            <h2>Login</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()">Login</button>
        </div>
        <div id="wallet" class="hidden">
            <h2>Wallet</h2>
            <img src="path/to/your/pupy-icon.png" alt="Pupy Credit Icon" class="icon">
            <div id="balance">Balance: 0 Pupicreditos</div>
            <button onclick="logout()">Logout</button>
            <h3>Transfer Pupicreditos</h3>
            <input type="number" id="amount" placeholder="Amount">
            <button onclick="transfer()">Transfer</button>
            <h3>Redeem Pupicreditos</h3>
            <input type="number" id="redeemAmount" placeholder="Amount to Redeem">
            <button onclick="redeem()">Redeem</button>
            <h3>Transactions</h3>
            <ul id="transactions"></ul>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCsAC7v-QXjUm4vvU7As4yRsIH9I5hgm28",
            authDomain: "pupiwallet.firebaseapp.com",
            projectId: "pupiwallet",
            storageBucket: "pupiwallet.appspot.com",
            messagingSenderId: "936137192119",
            appId: "1:936137192119:web:abdc9756a96184481b5332"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        const totalSupply = 10000;
        let currentSupply = totalSupply;

        const loginForm = document.getElementById('login-form');
        const wallet = document.getElementById('wallet');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const amountInput = document.getElementById('amount');
        const redeemAmountInput = document.getElementById('redeemAmount');
        const balanceElement = document.getElementById('balance');
        const transactionsElement = document.getElementById('transactions');

        const userEmail = "leoalegriaspam@gmail.com";
        const girlfriendEmail = "yasminagueropreply@gmail.com";

        onAuthStateChanged(auth, user => {
            if (user) {
                if (user.email === girlfriendEmail) {
                    console.log("Jasmina is logged in:", user);
                } else if (user.email === userEmail) {
                    console.log("Leonardo is logged in:", user);
                }
                loginForm.classList.add('hidden');
                wallet.classList.remove('hidden');
                loadWallet();
            } else {
                console.log("No user is logged in");
                loginForm.classList.remove('hidden');
                wallet.classList.add('hidden');
            }
        });

        window.login = function login() {
            const email = emailInput.value;
            const password = passwordInput.value;
            console.log("Attempting to log in with:", email);
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    console.log('Logged in:', userCredential.user);
                })
                .catch(error => {
                    console.error('Error logging in:', error);
                    alert('Error logging in: ' + error.message);
                });
        }

        window.logout = function logout() {
            signOut(auth)
                .then(() => {
                    console.log('Logged out');
                })
                .catch(error => {
                    console.error('Error logging out:', error);
                    alert('Error logging out: ' + error.message);
                });
        }

        window.transfer = function transfer() {
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            if (auth.currentUser.email !== userEmail) {
                alert("Only Leonardo can transfer Pupicreditos.");
                return;
            }
            if (currentSupply < amount) {
                alert("Insufficient Pupicreditos supply.");
                return;
            }
            const transaction = {
                from: userEmail,
                to: girlfriendEmail,
                amount,
                timestamp: serverTimestamp()
            };
            addDoc(collection(db, 'transactions'), transaction)
                .then(() => {
                    currentSupply -= amount;
                    amountInput.value = '';
                    loadWallet();
                })
                .catch(error => {
                    console.error('Error transferring Pupicreditos:', error);
                    alert('Error transferring Pupicreditos: ' + error.message);
                });
        }

        window.redeem = function redeem() {
            const amount = parseFloat(redeemAmountInput.value);
            if (isNaN(amount) || amount <= 0) {
                alert('Please enter a valid amount to redeem');
                return;
            }
            if (auth.currentUser.email !== girlfriendEmail) {
                alert("Only Yasmin can redeem Pupicreditos.");
                return;
            }
            const transaction = {
                from: girlfriendEmail,
                to: "burn",
                amount,
                timestamp: serverTimestamp()
            };
            addDoc(collection(db, 'transactions'), transaction)
                .then(() => {
                    redeemAmountInput.value = '';
                    loadWallet();
                })
                .catch(error => {
                    console.error('Error redeeming Pupicreditos:', error);
                    alert('Error redeeming Pupicreditos: ' + error.message);
                });
        }

        function loadWallet() {
            const user = auth.currentUser;
            const q = query(collection(db, 'transactions'), where('to', '==', user.email));
            onSnapshot(q, snapshot => {
                let balance = 0;
                const transactions = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    balance += data.amount;
                    transactions.push(data);
                });
                balanceElement.textContent = `Balance: ${balance} Pupicreditos`;
                transactionsElement.innerHTML = transactions.map(t => 
                    `<li>${t.amount} Pupicreditos from ${t.from} on ${t.timestamp.toDate().toLocaleString()}</li>`).join('');
            });
        }
    </script>
</body>
</html>
